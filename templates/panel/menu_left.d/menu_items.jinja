{%- from "lib/left_menu_style.jinja" import menu_bar_styles with context %}

{%- set left_menu = {} %}
{%- set plugins = data.get( "plugins" , {} ) %}
{%- for _ , plugin in plugins.items() %}
{%-     set plugin_catagory = plugin.get( "catagory" ) %}
{%-     set _update = left_menu.update( { plugin_catagory: {} } ) %}
{%- endfor %}
{%- set catagories = catagories | unique %}
{%- for _ , plugin in plugins.items() %}
{%-     set plugin_name = plugin.get( "name", "" ) %}
{%-     set plugin_catagory = plugin.get( "catagory" ) %}
{%-     for key , value in plugin.items() %}
{%-         set _update = left_menu[ plugin_catagory ].update( { plugin_name: plugin } ) %}
{%-     endfor %}
{%- endfor %}

{%- for catagory , plugins in left_menu.items() %}
{%-     set catagory_id = "%s_%s" | format( panel_id , catagory ) %}
    <button type="button" id="{{ catagory_id }}" class="menu_catagory">{{ catagory }}</button>
    <div id="{{ catagory_id }}" class="menu_plugins" style="display: block">
{%-     for plugin , yaml_file in plugins.items() %}
{%-         set plugin_id = "%s_%s" | format( catagory_id , plugin ) %}
{{plugin_id}}: {{plugin}} - {{yaml_file}}<br>
{%-     endfor %}
    </div>
{%- endfor %}

{#- Scripts #}
<script>
{#- Scripts for set menu item style #}
{%-     for class_name , style in menu_bar_styles.items() %}
let {{ class_name }} = document.getElementsByClassName( "{{ class_name }}" );
{%-         for attribute , value in style.items() %}
for( const element of {{ class_name }} ){
    element.style.{{ attribute }} = "{{ value }}";
}
{%-         endfor %}
{%-     endfor %}
{#- Script for menu item collapsing #}
var col = document.getElementsByClassName( "menu_catagory" );
var item;
for ( item = 0 ; item < col.length ; item++ ){
    col[ item ].addEventListener( "click" , function(){
        this.classList.toggle( "active" );
        var content = this.nextElementSibling;
        if( content.style.display === "block" ){
            content.style.display = "none";
        } else {
            content.style.display = "block";
        }
    });
}
</script>